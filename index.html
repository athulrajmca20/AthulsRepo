<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flappy Bird Game</title>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(#70c5ce, #ffffff);
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    canvas {
      background: #70c5ce;
      border: 2px solid #333;
      border-radius: 8px;
    }
    #overlay {
      position: absolute;
      top: 20px;
      text-align: center;
      width: 100%;
      color: #fff;
      font-size: 24px;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.6);
    }
  </style>
</head>
<body>
  <div id="overlay">Press SPACE or TAP to start</div>
  <canvas id="gameCanvas" width="400" height="600"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const overlay = document.getElementById('overlay');

    const ballImg = new Image();
    ballImg.src = "bird.png";

    const flapSound = new Audio("athul.m4a");
    const gameOverSound = new Audio("athul2.m4a");

    let bird, pipes, score, highScore, gravity, jump, pipeGap, pipeWidth, gameOver, started;

    function resetGame() {
      bird = { x: 50, y: 150, w: 40, h: 40, dy: 0 };
      pipes = [];
      score = 0;
      gravity = 0.18;   // gravity
      jump = -6;
      pipeGap = 180;
      pipeWidth = 60;
      gameOver = false;
      started = false;
      overlay.textContent = "Press SPACE or TAP to start";
      overlay.style.display = "block";
    }

    function drawBird() {
      ctx.drawImage(ballImg, bird.x - bird.w / 2, bird.y - bird.h / 2, bird.w, bird.h);
    }

    function drawPipes() {
      ctx.fillStyle = "green";
      pipes.forEach(p => {
        ctx.fillRect(p.x, 0, pipeWidth, p.top);
        ctx.fillRect(p.x, p.top + pipeGap, pipeWidth, canvas.height - p.top - pipeGap);
      });
    }

    function drawScore() {
      ctx.fillStyle = "white";
      ctx.font = "24px Arial";
      ctx.fillText(`Score: ${score}`, 10, 30);
      ctx.fillText(`High: ${highScore}`, 10, 60);
    }

    function update() {
      if (!started || gameOver) return;

      bird.dy += gravity;
      bird.y += bird.dy;

      if (bird.y + bird.h/2 >= canvas.height) endGame();
      if (bird.y - bird.h/2 <= 0) { bird.y = bird.h/2; bird.dy = 0; }

      if (pipes.length === 0 || pipes[pipes.length-1].x < canvas.width - 200) {
        let top = Math.random() * (canvas.height - pipeGap - 100) + 50;
        pipes.push({ x: canvas.width, top });
      }

      pipes.forEach(p => p.x -= 2);
      if (pipes[0] && pipes[0].x + pipeWidth < 0) pipes.shift();

      pipes.forEach(p => {
        if (bird.x + bird.w/2 > p.x && bird.x - bird.w/2 < p.x + pipeWidth) {
          if (bird.y - bird.h/2 < p.top || bird.y + bird.h/2 > p.top + pipeGap) {
            endGame();
          }
        }
        if (!p.passed && p.x + pipeWidth < bird.x) {
          score++;
          p.passed = true;
          if (score > highScore) {
            highScore = score;
            localStorage.setItem('flappy_high', highScore);
          }
        }
      });
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBird();
      drawPipes();
      drawScore();

      if (gameOver) {
        ctx.fillStyle = "red";
        ctx.font = "36px Arial";
        ctx.fillText("GAME OVER", canvas.width/2 - 100, canvas.height/2);
      }
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    function flap() {
      if (!started) {
        started = true;
	flapSound.play()
        overlay.style.display = 'none';
      }
      if (!gameOver) {
        bird.dy = jump;
        flapSound.play(); // play flap sound
      } else {
        resetGame();
      }
    }

    function endGame() {
      if (!gameOver) gameOverSound.play(); // play game over sound
      gameOver = true;
      overlay.style.display = 'block';
      overlay.textContent = "GAME OVER - Press SPACE or TAP to Restart";
    }

    window.addEventListener('keydown', e => { if (e.code === 'Space') flap(); });
    canvas.addEventListener('mousedown', flap);
    canvas.addEventListener('touchstart', flap);

    highScore = Number(localStorage.getItem('flappy_high') || 0);
    resetGame();

    // Start loop after ball image loads
    ballImg.onload = () => {
      loop();
    };
  </script>
</body>
</html>
